# Проект "widgetBack".

#### В данном проекте представлена backend-составляющая виджета личного кабинета клиентов
#### банка. Виджет показывает несколько последних успешных банковских операций клиента для
#### личного кабинета.

### Цель проекта:
#### подготовить на бэкенде данные для отображения в новом виджете.

---------------------------------------

## СОЖЕРЖАНИЕ.

### [I. Описание](#i-описание)
### [II. Установка](#ii-установка)
### [III. Тестирование](#iii-тестирование)
### [IV. Примеры использования модулей](#iv-примеры-использования-модулей)
### [V. Лицензия](#v-лицензия)


## I. Описание <a name="i-описание"></a>
Проект реализован в виде базовой структуры модулями в директории **/src**, помимо
зависимостей проекта. Модули в **/src**:
- **masks.py**
- **widget.py**
- **processing.py**
- **generators.py**
- **decorators.py**
- **transactions_import.py**
- **filters.py**

Основной модуль, который собирает все функциональности проекта при запуске - модуль ***main.py*** в корне
проекта. ***Функция main*** в одноименном модуле отвечает за основную логику проекта и связывает
функциональности остальных функций между собой.

#### Пример работы функции:

```
Программа: Привет! Добро пожаловать в программу работы 
с банковскими транзакциями. 
Выберите необходимый пункт меню:
1. Получить информацию о транзакциях из JSON-файла
2. Получить информацию о транзакциях из CSV-файла
3. Получить информацию о транзакциях из XLSX-файла

Пользователь: 1

Программа: Для обработки выбран JSON-файл.

Программа: Введите статус, по которому необходимо выполнить фильтрацию. 
Доступные для фильтровки статусы: EXECUTED, CANCELED, PENDING

Пользователь: EXECUTED

Программа: Операции отфильтрованы по статусу "EXECUTED"

Программа: Отсортировать операции по дате? Да/Нет

Пользователь: да

Программа: Отсортировать по возрастанию или по убыванию? 

Пользователь: по возрастанию/по убыванию

Программа: Выводить только рублевые транзакции? Да/Нет

Пользователь: да

Программа: Отфильтровать список транзакций по определенному слову 
в описании? Да/Нет

Пользователь: да/нет

Программа: Распечатываю итоговый список транзакций...

Программа: 
Всего банковских операций в выборке: 4

08.12.2019 Открытие вклада 
Счет **4321
Сумма: 40542 руб. 

12.11.2019 Перевод с карты на карту
MasterCard 7771 27** **** 3727 -> Visa Platinum 1293 38** **** 9203
Сумма: 130 USD

18.07.2018 Перевод организации 
Visa Platinum 7492 65** **** 7202 -> Счет **0034
Сумма: 8390 руб.

03.06.2018 Перевод со счета на счет
Счет **2935 -> Счет **4321
Сумма: 8200 EUR
```

***
***


### <ins>Модуль masks.py</ins>

### Функция маскировки номера банковской карты **get_mask_card_number**.
Функция принимает
на вход номер карты и возвращает ее маску в формате XXXX XX** **** XXXX, где X — это
цифра номера.

#### Пример работы функции:

```
7000792289602857     # входной аргумент
7000 79** **** 2857      # возврат функции
```

### Функция маскировки номера банковского счета **get_mask_account**.
Функция принимает на вход номер счета и возвращает его маску в формате **XXXX,
где X — это цифра номера.

#### Пример работы функции:

```
73654108430135875013      # входной аргумент
**5013     # возврат функции
```

### <ins>Модуль widget.py</ins>
Этот модуль содержит функции для работы с новыми возможностями приложения.

### Функция **mask_account_card**
Умеет обрабатывать информацию как о картах, так и
о счетах: принимает один аргумент — строку, содержащую тип и номер карты или счета,
— возвращает строку с замаскированным номером. Для карт и счетов используются разные
типы маскировки.

#### Пример для карты
```
Visa Gold 7000792289602857  # входной аргумент
Visa Gold 7000 79** **** 2857  # выход функции
```

#### Пример для счета
```
Счет 73654108430135875013  # входной аргумент
Счет **5013  # выход функции
```

Функция **get_date** — принимает на вход строку с датой в формате
**"2024-05-11T04:22:16.671907"** и возвращает строку с датой в формате
**"ДД.ММ.ГГГГ" ("11.05.2024")**.


### <ins>Модуль processing.py</ins>

Данный модуль содержит функции для обработки новых типов данных.

### Функция **filter_by_state**.
Принимает список словарей и опционально значение для ключа
**state** (по умолчанию — **'EXECUTED'**). Функция возвращает новый список словарей,
содержащий только те словари, у которых ключ **state** соответствует указанному значению.

### Пример работы функции:

#### Входные данные

```
[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'},
{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'},
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}]
```

#### Возврат функции со статусом по умолчанию 'EXECUTED'

```
[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'},
{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]
```

### Функция **sort_by_date**.
Принимает список словарей и необязательный параметр,
задающий порядок сортировки (по умолчанию — убывание). Функция возвращает новый
список, отсортированный по дате.

### Пример работы функции:

#### Входные данные
```
[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'},
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'},
{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}]
```

#### Возврат функции (сортировка по убыванию)
```
[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'},
{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'},
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}]
```

### <ins>Модуль generators.py</ins>

Функции в данном модуле реализуют генераторы для обработки данных.

### Функция **filter_by_currency**
Принимает на вход список словарей, представляющих
транзакции. Функция возвращает итератор, который поочередно выдает транзакции,
где валюта операции соответствует заданной.

#### Пример работы функции **filter_by_currency**:

#### Входные данные
```
[
        {
            "id": 939719570,
            "state": "EXECUTED",
            "date": "2018-06-30T02:08:58.425572",
            "operationAmount": {
                "amount": "9824.07",
                "currency": {
                    "name": "USD",
                    "code": "USD"
                }
            },
            "description": "Перевод организации",
            "from": "Счет 75106830613657916952",
            "to": "Счет 11776614605963066702"
        },
        {
            "id": 142264268,
            "state": "EXECUTED",
            "date": "2019-04-04T23:20:05.206878",
            "operationAmount": {
                "amount": "79114.93",
                "currency": {
                    "name": "USD",
                    "code": "USD"
                }
            },
            "description": "Перевод со счета на счет",
            "from": "Счет 19708645243227258542",
            "to": "Счет 75651667383060284188"
        },
        {
            "id": 873106923,
            "state": "EXECUTED",
            "date": "2019-03-23T01:09:46.296404",
            "operationAmount": {
                "amount": "43318.34",
                "currency": {
                    "name": "руб.",
                    "code": "RUB"
                }
            },
            "description": "Перевод со счета на счет",
            "from": "Счет 44812258784861134719",
            "to": "Счет 74489636417521191160"
        }
]
```
#### Возврат функции (по USD)
```
{
    "id": 939719570,
    "state": "EXECUTED",
    "date": "2018-06-30T02:08:58.425572",
    "operationAmount": {
        "amount": "9824.07",
        "currency": {
            "name": "USD",
            "code": "USD"
        }
    },
    "description": "Перевод организации",
    "from": "Счет 75106830613657916952",
    "to": "Счет 11776614605963066702"
}
{
    "id": 142264268,
    "state": "EXECUTED",
    "date": "2019-04-04T23:20:05.206878",
    "operationAmount": {
        "amount": "79114.93",
        "currency": {
            "name": "USD",
            "code": "USD"
        }
    },
    "description": "Перевод со счета на счет",
    "from": "Счет 19708645243227258542",
    "to": "Счет 75651667383060284188"
}
```
***
### Функция **transaction_descriptions**.
Принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.

#### Пример работы функции **transaction_descriptions**:

#### Входные данные
```
[
        {
            "id": 939719570,
            "state": "EXECUTED",
            "date": "2018-06-30T02:08:58.425572",
            "operationAmount": {
                "amount": "9824.07",
                "currency": {
                    "name": "USD",
                    "code": "USD"
                }
            },
            "description": "Перевод организации",
            "from": "Счет 75106830613657916952",
            "to": "Счет 11776614605963066702"
        },
        {
            "id": 142264268,
            "state": "EXECUTED",
            "date": "2019-04-04T23:20:05.206878",
            "operationAmount": {
                "amount": "79114.93",
                "currency": {
                    "name": "USD",
                    "code": "USD"
                }
            },
            "description": "Перевод со счета на счет",
            "from": "Счет 19708645243227258542",
            "to": "Счет 75651667383060284188"
        },
        {
            "id": 873106923,
            "state": "EXECUTED",
            "date": "2019-03-23T01:09:46.296404",
            "operationAmount": {
                "amount": "43318.34",
                "currency": {
                    "name": "руб.",
                    "code": "RUB"
                }
            },
            "description": "Перевод со счета на счет",
            "from": "Счет 44812258784861134719",
            "to": "Счет 74489636417521191160"
        },
        {
            "id": 895315941,
            "state": "EXECUTED",
            "date": "2018-08-19T04:27:37.904916",
            "operationAmount": {
                "amount": "56883.54",
                "currency": {
                    "name": "USD",
                    "code": "USD"
                }
            },
            "description": "Перевод с карты на карту",
            "from": "Visa Classic 6831982476737658",
            "to": "Visa Platinum 8990922113665229"
        },
        {
            "id": 594226727,
            "state": "CANCELED",
            "date": "2018-09-12T21:27:25.241689",
            "operationAmount": {
                "amount": "67314.70",
                "currency": {
                    "name": "руб.",
                    "code": "RUB"
                }
            },
            "description": "Перевод организации",
            "from": "Visa Platinum 1246377376343588",
            "to": "Счет 14211924144426031657"
        }
]
```

#### Возврат функции
```
Перевод организации
Перевод со счета на счет
Перевод со счета на счет
Перевод с карты на карту
Перевод организации
```

***

- ### функция card_number_generator
Выдает номера банковских карт в формате XXXX XXXX XXXX XXXX, где X — цифра номера карты.
Эта функция может сгенерировать номера карт в заданном диапазоне от 0000 0000 0000 0001
до 9999 9999 9999 9999. Должна принимать начальное и конечное значения для
генерации диапазона номеров.

#### Пример работы функции **card_number_generator**:

#### Входные данные
```
2398 2400
```

#### Возврат функции
```
0000 0000 0000 2398
0000 0000 0000 2399
0000 0000 0000 2400
```

### <ins>Модуль decorators.py</ins>


Для обеспечения более глубокого контроля и анализа поведения программы в процессе
ее выполнения, проект виджета оснащён дополнительным модулем, функционально
представленным в виде декоратора **log**.
Декоратором является функция, которая принимает прочие функции в качестве аргумента и
изменяет их работу без преобразования самих функций.
В данном случае, **log**, выступает в качестве декоратора с параметрами: он
принимает необязательный аргумент ***filename*** для указания, куда логировать работу
функций, в файл или консоль.

#### Общий порядок работы декоратора:


- Если ***filename*** задан, логи записываются в указанный файл.
- Если ***filename*** не задан, логи выводятся в консоль.

#### Логирование включает:

- Имя функции и результат выполнения при успешной операции.
- Имя функции, тип возникшей ошибки и входные параметры, если выполнение функции привело к ошибке.

Декоратор **log** написан с использованием другого декоратора — ***wraps***. Он позволяет передать
метаданные (например, docstrings) другому объекту — декорируемой функции.

### Использование wraps в модуле:
```
def log(filename=None):
    def logging_of_function(function):
        @wraps(function)   # здесь используем декоратор wraps
        def wrapper(*args, **kwargs):
        ......
        ...
```
#### Пример работы декоратора **log**:

#### Входные данные
```
@log(filename="some_log.txt")
def some_function(x, y):
    return x + y

some_function(1, 2)
```
#### Ожидаемый вывод в лог-файл:
###### - При успешном выполнении
```
my_function ok
```
###### - При возврате ошибки
```
my_function error: тип ошибки. Inputs: (1, 2), {}
```
На месте ``` тип ошибки``` указывается текст ошибки.


### <ins>Модуль</ins> transactions_import.py


Так как источником о финансовых данных могут быть .csv- и .xlsx- файлы, проект "widgetBack"
дополняется модулем, который может выводить содержимое таблиц из файла в виде списка
словарей. В данном случае подразумеваются транзакции клиентов, которые считывает функция
**get_operations_data** из .csv- и .xlsx- файлов, т.е. на вход эта функция принимает только
путь к файлу в качестве аргумента.
Модуль написан так, что возвращает всегда список:
- если преобразование выполнено успешно, возвращается список словарей с данными;
- если путь к файлу не найден или неверное расширение, то возвращается пустой список
с указанием проблемы;
- если корректное преобразование невозможно, то, также возвращается пустой список
с сообщением исключения(Exception).


#### Пример работы функции **get_operations_data**:

#### Входные данные
```
../data/example.csv
```

#### Возврат функции
```
[
    {"user": "John", "age": 22, "city": "London"},
    {"user": "Victor", "age": 31, "city": "Edinburgh"},
    {"user": "Marissa", "age": 25, "city": "Hampshire"}
]
```


### <ins>Модуль filters.py</ins>

Для более структурированного статистически отображения данных о транзакциях в проект
добавлены две дополнительные функции в модуле ***filters.py***: get_process_search и
process_bank_operations.

- ### функция get_process_search

Принимет список словарей с данными о банковских операциях и строку поиска, а возвращает
список словарей, у которых в описании есть данная строка. В этой функции использована
библиотека ***re*** для работы с регулярными выражениями.

#### Пример работы функции **get_process_search**:

#### Входные данные

```
if __name__ == "__main__":
    print(get_process_search(bank_data=[
        {
            "id": 939719570,
            "state": "EXECUTED",
            "date": "2018-06-30T02:08:58.425572",
            "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
            "description": "Перевод организации",
            "from": "Счет 75106830613657916952",
            "to": "Счет 11776614605963066702",
        },
        {
            "id": 587085106,
            "state": "EXECUTED",
            "date": "2018-03-23T10:45:06.972075",
            "operationAmount": {"amount": "48223.05", "currency": {"name": "руб.", "code": "RUB"}},
            "description": "Открытие вклада",
            "to": "Счет 41421565395219882431",
        },
        {
            "id": 142264268,
            "state": "EXECUTED",
            "date": "2019-04-04T23:20:05.206878",
            "operationAmount": {"amount": "79114.93", "currency": {"name": "USD", "code": "USD"}},
            "description": "Перевод со счета на счет",
            "from": "Счет 19708645243227258542",
            "to": "Счет 75651667383060284188",
        },
    ], row_search="счета"))
```

#### Возврат функции
```
    [
        {
            "id": 142264268,
            "state": "EXECUTED",
            "date": "2019-04-04T23:20:05.206878",
            "operationAmount": {"amount": "79114.93", "currency":
                {"name": "USD", "code": "USD"}},
            "description": "Перевод со счета на счет",
            "from": "Счет 19708645243227258542",
            "to": "Счет 75651667383060284188",
        }
    ]
```

- ### функция process_bank_operations

Принимает список словарей с данными о банковских операциях и список категорий операций,
а возвращает словарь, в котором ключи — это названия категорий, а значения — это
количество операций в каждой категории. Категории операций хранятся в поле description.


#### Пример работы функции **process_bank_operations**:

#### Входные данные

```
if __name__ == "__main__":
    print(process_bank_operations(transactions_data=[
        {"from": "Счет 19708645243227258542", "to": "Счет 75651667383060284188"},
        {"from": "Счет 44812258784861134719", "to": "Счет 74489636417521191160"},
        {"from": "Счет 10848359769870775355", "to": "Счет 21969751544412966366"},
        {"description": None, "from": "Visa Classic 6831982476737658", "to": "Visa Platinum 8990922113665229"}
            ], categories_names=[]))
```
#### Возврат функции

```
    {}
```


***
***

## II. Установка <a name="ii-установка"></a>

#### *1. Клонируйте репозиторий:*

```
git clone https://github.com/jaineut-deep/home_work_10-1.git
```

#### *2. Установите Poetry (рекомендуется):*

- Зайдите на сайт https://python-poetry.org/ и перейдите в раздел Documentation
—> Introduction —> Installation.


- Здесь вы найдете команды для установки Poetry (в данном примере указаны для Ubuntu).
Выполните в терминале:
```
sudo curl -sSL https://install.python-poetry.org/ | python3 -
```
- Запустится установка Poetry.
Более подробно про установку Poetry см. на
[сайте](https://python-poetry.org/docs/#installing-with-the-official-installer) проекта.


#### *3. Установите зависимости:*

```
poetry install
```

Эта команда автоматически установит все зависимости, которые перечислены в разделе
**[tool.poetry.dependencies]** и в любых других определенных группах зависимостей
в файле **pyproject.toml**.

## III. Тестирование <a name="iii-тестирование"></a>

Чтобы протестировать модули проекта в PyCharm необходимо установить фреймворк pytest:
```
poetry add --group dev pytest
```

В папке **tests** находятся тестовые файлы, которые можно запустить простой командой:
```
pytest
```



## IV. Примеры использования модулей <a name="iv-примеры-использования-модулей"></a>

Чтобы использовать функции из модуля в другом скрипте или в интерпретаторе, его
нужно импортировать. Python ищет модули в определенных местах: в текущей директории,
в стандартных путях установки и в путях, указанных в переменной окружения PYTHONPATH.

#### *Способ 1: Импорт всего модуля:*

```
import masks

result = masks.get_mask_card_number(7000792289602857)
print(result)  # Выведет: 7000 79** **** 2857

card_mask = masks.get_mask_account(73654108430135875013)
print(card_mask)    # Выведет: **5013
```

#### *Способ 2: Импорт конкретных функций (рекомендуется):*

```
from masks import get_mask_card_number, get_mask_account

result = get_mask_account(73654108430135875013)  # Теперь можно вызывать напрямую
print(result)  # Выведет: **5013
```


### ВНИМАНИЕ:
**!!! Нельзя менять базовую структуру директории /src !!!** Это нарушит работу модулей,
а значит и проекта в целом! По мере развития проекта базовая структура может быть
расширена дополнительными модулями.


## V. Лицензия <a name="v-лицензия"></a>

Проект распространяется под [лицензией MIT](LICENSE).